<div class="register-layout">
  <!-- COLUMNA IZQUIERDA: Branding (Solo visible en desktop) -->
  <div class="register-brand">
    <div class="brand-content">
      <h2 class="brand-title">Únete al Movimiento</h2>
      <p class="brand-quote">
        "Hace falta volver a sentir que nos necesitamos unos a otros, que tenemos una responsabilidad por los demás y por el mundo."
      </p>
      <p class="brand-cite">- Laudato Si', 229</p>
    </div>
    <!-- Overlay decorativo -->
    <div class="brand-overlay"></div>
  </div>

  <!-- COLUMNA DERECHA: Formulario -->
  <div class="register-form-container">
    <div class="form-wrapper">
      
      <header class="form-header">
        <h1>Crear Cuenta</h1>
        <p>Completa tus datos para formar parte de la comunidad.</p>
      </header>

      <form [formGroup]="registroUsuario" (ngSubmit)="submitUsuario()" class="main-form">
        
        <!-- SECCIÓN: DATOS PERSONALES -->
        <div class="form-section">
          <label class="section-label">Información Personal</label>
          
          <div class="form-group">
            <label for="name">Nombre Completo</label>
            <div class="input-with-icon">
              <i class="fas fa-user icon"></i>
              <input id="name" type="text" formControlName="usuarioNombre" placeholder="Juan Pérez">
            </div>
            @if(registroUsuario.controls['usuarioNombre'].touched && registroUsuario.controls['usuarioNombre'].invalid){
              <span class="error-msg">Por favor, introduce tu nombre completo.</span>
            }
          </div>

          <div class="form-group">
            <label for="username">Nombre de Usuario</label>
            <div class="input-with-icon">
              <i class="fas fa-at icon"></i>
              <input id="username" type="text" formControlName="usuarioId" placeholder="juanperez">
            </div>
            @if(registroUsuario.controls['usuarioId'].touched && registroUsuario.controls['usuarioId'].invalid){
               @if(registroUsuario.controls['usuarioId'].hasError('required')) { <span class="error-msg">Requerido.</span> }
               @else if(registroUsuario.controls['usuarioId'].hasError('user')) { <span class="error-msg">Usuario en uso.</span> }
               @else { <span class="error-msg">Mínimo 3 caracteres.</span> }
            }
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="nacimiento">Fecha de Nacimiento</label>
              <div class="input-with-icon">
                <i class="fas fa-calendar-alt icon"></i>
                <input id="nacimiento" type="date" formControlName="usuarioNacimiento">
              </div>
            </div>
            
            <div class="form-group">
              <label for="genero">Género</label>
              <div class="select-wrapper">
                <i class="fas fa-venus-mars icon"></i>
                <select id="genero" formControlName="usuarioGenero">
                  <option value="" disabled selected>Seleccionar...</option>
                  <option value="masculino">Masculino</option>
                  <option value="femenino">Femenino</option>
                  <option value="otro">Otro</option>
                  <option value="no_especificar">Prefiero no especificar</option>
                </select>
                <i class="fas fa-chevron-down arrow"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- SECCIÓN: SEGURIDAD -->
        <div class="form-section">
          <label class="section-label">Seguridad</label>
          
          <div class="form-group">
            <label for="email">Correo Electrónico</label>
            <div class="input-with-icon">
              <i class="fas fa-envelope icon"></i>
              <input id="email" type="email" formControlName="usuarioEmail" placeholder="juan@ejemplo.com">
            </div>
            @if(registroUsuario.controls['usuarioEmail'].touched && registroUsuario.controls['usuarioEmail'].invalid){
              <span class="error-msg">Introduce un correo válido.</span>
            }
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="password">Contraseña</label>
              <div class="input-with-icon">
                <i class="fas fa-lock icon"></i>
                <input id="password" type="password" formControlName="usuarioContraseña" placeholder="••••••••">
              </div>
              @if(registroUsuario.controls['usuarioContraseña'].touched && registroUsuario.controls['usuarioContraseña'].invalid){
                <span class="error-msg">Mín. 8 chars, letras y números.</span>
              }
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirmar</label>
              <div class="input-with-icon">
                <i class="fas fa-lock icon"></i>
                <input id="confirmPassword" type="password" formControlName="usuarioConfirmar" placeholder="••••••••">
              </div>
              @if(registroUsuario.hasError('passwordMismatch') && registroUsuario.get('usuarioConfirmar')?.touched){
                <span class="error-msg">No coinciden.</span>
              }
            </div>
          </div>
        </div>

        <!-- SECCIÓN: EXTRAS (Foto y Términos) -->
        <div class="form-section extra-section">
          <div class="form-group file-upload-group">
            <label class="file-label-text">Foto de Perfil (Opcional)</label>
            <div class="file-upload-row">
              <label for="file-upload" class="btn-file">
                <i class="fas fa-camera"></i> Subir Foto
              </label>
              <input id="file-upload" type="file" (change)="onFileSelected($event)" accept="image/*" class="file-input-hidden">
              
              @if (imagenPreview) {
                <img [src]="imagenPreview" class="avatar-preview">
              } @else {
                <span class="file-status">Sin archivo</span>
              }
            </div>
          </div>

          <div class="form-group terms-group">
            <label class="checkbox-container">
              <input type="checkbox" formControlName="aceptaTerminos">
              <span class="checkmark"></span>
              <span class="terms-text">
                Acepto los <a href="#">términos y condiciones</a> y la <a href="#">política de privacidad</a>.
              </span>
            </label>
            @if(registroUsuario.controls['aceptaTerminos'].touched && registroUsuario.controls['aceptaTerminos'].invalid){
              <span class="error-msg">Debes aceptar para continuar.</span>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit" [disabled]="registroUsuario.invalid">
            Registrarse
          </button>
          <p class="login-hint">
            ¿Ya tienes cuenta? <a routerLink="/">Inicia sesión</a>
          </p>
        </div>

      </form>
    </div>
  </div>
</div>